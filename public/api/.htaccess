# Deny direct access to all PHP files in this directory
Order Deny,Allow
Deny from all

# Only allow access to api_handler.php (which has its own security)
<Files "api_handler.php">
    Order Allow,Deny
    Allow from all
</Files>

# Prevent directory listing
Options -Indexes

# Security headers
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# Block common attack patterns
<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Block direct access to old API files
    RewriteRule ^(session_status|refresh_session)\.php$ - [F,L]
    
    # Block access to any other PHP files except api_handler.php
    RewriteCond %{REQUEST_FILENAME} -f
    RewriteCond %{REQUEST_FILENAME} \.php$
    RewriteCond %{REQUEST_FILENAME} !api_handler\.php$
    RewriteRule .* - [F,L]
</IfModule>
